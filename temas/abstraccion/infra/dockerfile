# Usamos la imagen oficial de Jenkins con LTS y JDK 17
FROM jenkins/jenkins:lts-jdk17

# Cambiamos a root para instalar dependencias
USER root

# Instalamos dependencias para .NET
RUN apt-get update && \
    apt-get install -y wget apt-transport-https && \
    wget https://packages.microsoft.com/config/debian/11/packages-microsoft-prod.deb -O packages-microsoft-prod.deb && \
    dpkg -i packages-microsoft-prod.deb && \
    rm packages-microsoft-prod.deb && \
    apt-get update && \
    apt-get install -y dotnet-sdk-8.0

# Instalamos plugins esenciales para Jenkins
RUN jenkins-plugin-cli --plugins "workflow-aggregator git dotnet-sdk"

# Configuramos variables de entorno para .NET
ENV DOTNET_CLI_TELEMETRY_OPTOUT=1
ENV PATH="$PATH:/home/jenkins/.dotnet/tools"

# Volvemos al usuario jenkins
USER jenkins

# Puerto expuesto
EXPOSE 8080
EXPOSE 50000